"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),LittleFoot=function(){function t(){var e=this,o=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var n={scope:document,divFootnotesQuery:".footnotes",footnotesQuery:"[id^='fn']",fnButtonMarkup:'<button class="footnote-button" id="{{FOOTNOTEREFID}}" data-footnote="{{FOOTNOTEID}}" alt="See Footnote {{FOOTNOTENUMBER}}" rel="footnote" data-fn-number="{{FOOTNOTENUMBER}}" data-fn-content="{{FOOTNOTECONTENT}}"></button>',fnContentMarkup:'<div class="littlefoot-footnote" id="{{FOOTNOTEID}}"><div class="footnote-wrapper"><div class="footnote-content">{{FOOTNOTECONTENT}}</div></div><div class="footnote-tooltip" aria-hidden="true"></div>'};return this.config=Object.assign({},n,o),this.divFootnotes=[].slice.call(this.config.scope.querySelectorAll(this.config.divFootnotesQuery)),this.divFootnotes?void(this.footnotes=this.divFootnotes.map(function(t){return t.querySelectorAll(e.config.footnotesQuery)})):!1}return _createClass(t,[{key:"init",value:function(){this.footnoteButtonsBuilder(),this.actionSetup()}},{key:"removeBackLinks",value:function(t,e){var o=void 0;return e.indexOf(" ")>=0&&(e=e.trim().replace(/\s+/g,"|").replace(/(.*)/g,"($1)")),o=new RegExp("(\\s|&nbsp;)*<\\s*a[^#<]*#"+e+"[^>]*>(.*?)<\\s*/\\s*a>","g"),t.replace(o,"").replace("[]","")}},{key:"buildButton",value:function(t,e,o,n){return this.config.fnButtonMarkup.replace(/\{\{FOOTNOTEREFID\}\}/g,t).replace(/\{\{FOOTNOTEID\}\}/g,e).replace(/\{\{FOOTNOTENUMBER\}\}/g,o).replace(/\{\{FOOTNOTECONTENT\}\}/g,n)}},{key:"buildContent",value:function(t,e){return this.config.fnContentMarkup.replace(/\{\{FOOTNOTEID\}\}/g,t).replace(/\{\{FOOTNOTECONTENT\}\}/g,e)}},{key:"clickAction",value:function(t){var e=void 0,o=void 0,n=void 0,i=void 0,a=void 0;e=t.target,o=e.getAttribute("data-fn-content"),n=e.getAttribute("data-footnote"),this.removeFootnotes(),e.nextElementSibling||(i=this.buildContent(n,o),e.insertAdjacentHTML("afterend",i),a=e.nextElementSibling,this.calculateOffset(a,e),this.calculateSpacing(a),e.classList.add("is-active"),a.classList.add("footnote-is-active"),"ontouchstart"in document.documentElement&&document.body.classList.add("footnote-backdrop"))}},{key:"calculateOffset",value:function(t,e){var o=void 0,n=void 0,i=void 0,a=void 0,c=void 0,r=void 0,l=void 0,s=void 0,u=void 0,d=void 0,f=void 0,v=void 0;e=e||t.previousElementSibling,i=e.offsetLeft,a=e.offsetWidth,o=t.querySelector(".footnote-tooltip"),d=o.clientWidth,n=t.parentNode,c=n.clientWidth,r=n.offsetLeft,l=t.offsetWidth,s=-(l/2-c/2),v=window.outerWidth||window.availWidth,0>r+s?s-=r+s:r+s+l>v&&(s-=r+s+l-v),t.style.left=s+"px",u=r+s,f=r-u+c/2-d/2,o.style.left=f+"px"}},{key:"removeFootnoteChild",value:function(t){return t.parentNode.removeChild(t)}},{key:"debounce",value:function(t,e,o){var n;return function(){var i=this,a=arguments,c=function(){n=null,o||t.apply(i,a)},r=o&&!n;clearTimeout(n),n=setTimeout(c,e),r&&t.apply(i,a)}}},{key:"resizeAction",value:function(){var t=document.querySelectorAll(".footnote-is-active");if(t){var e=!0,o=!1,n=void 0;try{for(var i,a=t[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var c=i.value;console.log(c),this.calculateOffset(c),this.calculateSpacing(c)}}catch(r){o=!0,n=r}finally{try{!e&&a["return"]&&a["return"]()}finally{if(o)throw n}}}}},{key:"calculateSpacing",value:function(t){var e=void 0,o=void 0,n=void 0,i=void 0,a=void 0;i=this.calculateMargins(t),a=window.innerHeight||window.availHeight,e=t.getBoundingClientRect(),o=e.height,n=e.bottom,n>a-i.bottom?t.classList.add("footnote-is-top"):a-(o+i.top)>n&&t.classList.contains("footnote-is-top")&&t.classList.remove("footnote-is-top")}},{key:"scrollAction",value:function(){var t=this,e=document.querySelectorAll(".footnote-is-active");if(e){window.innerHeight||window.availHeight,this.calculateMargins(e[0]);[].forEach.call(e,function(e){t.calculateSpacing(e)})}}},{key:"calculateMargins",value:function(t){var e=window.getComputedStyle(t,null);return{top:parseFloat(e.marginTop),right:parseFloat(e.marginRight),bottom:parseFloat(e.marginBottom),left:parseFloat(e.marginLeft)}}},{key:"closestClass",value:function(t,e){do try{if(t.classList.contains(e))return t}catch(o){if(o instanceof TypeError)return null}while(t=t.parentNode);return null}},{key:"documentAction",value:function(t){this.closestClass(t.target,"footnote-container")||this.removeFootnotes()}},{key:"removeFootnotes",value:function(){var t=this,e=document.querySelectorAll(".footnote-is-active");e&&[].forEach.call(e,function(e){e.previousElementSibling.classList.remove("is-active"),e.addEventListener("transitionend",t.removeFootnoteChild(e),!1),e.classList.remove("footnote-is-active")}),document.body.classList.contains("footnote-backdrop")&&document.body.classList.remove("footnote-backdrop")}},{key:"footnoteButtonsBuilder",value:function(){var t=this;[].forEach.call(this.footnotes,function(e,o){[].forEach.call(e,function(e,o){var n=void 0,i=void 0,a=void 0,c=void 0,r=void 0;c=o+1,i=e.querySelector('a[href^="#fnref"]').getAttribute("href").substring(1),n=t.removeBackLinks(e.innerHTML.trim(),i),n=n.replace(/"/g,"&quot;").replace(/&lt;/g,"&ltsym;").replace(/&gt;/g,"&gtsym;"),0!==n.indexOf("<")&&(n="<p>"+n+"</p>"),a=document.getElementById(i),r='<div class="footnote-container">'+t.buildButton(i,e.id,c,n)+"</div>",a.insertAdjacentHTML("afterend",r),a.parentNode.removeChild(a)})})}},{key:"actionSetup",value:function(){var t=this,e=this.config.scope.querySelectorAll(".footnote-button");[].forEach.call(e,function(e){e.addEventListener("click",t.clickAction.bind(t))}),window.addEventListener("resize",this.debounce(this.resizeAction.bind(this),100)),window.addEventListener("scroll",this.debounce(this.scrollAction.bind(this),100)),document.body.addEventListener("click",this.documentAction.bind(this)),document.body.addEventListener("touchend",this.documentAction.bind(this)),this.divFootnotes.forEach(function(t){return t.parentNode.removeChild(t)})}}]),t}(),lf=new LittleFoot;lf.init();